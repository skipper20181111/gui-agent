# 蚂蚁阿福投名状

## 目录

- [1. 蚂蚁阿福产品思考：母婴全周期场景](#1-蚂蚁阿福产品思考母婴全周期场景)
- [2. GUI Agent 挂号场景 Demo](#2-gui-agent-挂号场景-demo)
  - [2.1 项目简介](#21-项目简介)
  - [2.2 技术方案选型](#22-技术方案选型)
  - [2.3 模型选型](#23-模型选型)
  - [2.4 Agent 框架选型](#24-agent-框架选型)
  - [2.5 Token 优化策略](#25-token-优化策略)
  - [2.6 工具集设计](#26-工具集设计)
  - [2.7 技术总结](#27-技术总结)

---

## 1. 蚂蚁阿福产品思考：母婴全周期场景

### 1.1 背景

蚂蚁阿福定位为 **AI 健康伴侣**，核心价值是"让你少生病、晚生病、更懂自己身体"。当前产品在慢病管理、健康咨询等场景已有布局，但在 **母婴全周期健康管理** 这一高频、刚需场景仍有较大空白。

母婴场景的特殊性：
- **时间敏感**：从备孕到育儿，每个阶段都有明确的时间窗口和关键任务
- **信息焦虑**：新手父母面临海量信息，难以判断可靠性
- **决策高频**：饮食、检查、护理等决策几乎每天都在发生
- **情感需求**：孕期和育儿期的心理支持同样重要

### 1.2 场景分析

#### 1.2.1 备孕期

| 功能 | 描述 | 价值 |
|------|------|------|
| **孕前检查指南** | 男/女常见孕前检查项目、时机、注意事项 | 减少信息焦虑，避免遗漏关键检查 |
| **基因筛查解读** | 常见遗传病筛查项目科普，报告通俗化解读 | 辅助理解专业报告，降低决策门槛 |
| **备孕营养建议** | 叶酸补充、饮食调整等个性化建议 | 科学备孕，提前干预 |

#### 1.2.2 孕期

| 功能 | 描述 | 价值 |
|------|------|------|
| **胎动记录** | 便捷记录胎动次数、时间、规律 | 早期发现异常，减少焦虑 |
| **孕检记录管理** | 上传、存储、整理各次产检报告 | 一站式管理，就医时快速调阅 |
| **胎儿发育追踪** | 按孕周展示胎儿发育指标、参考范围 | 直观了解发育情况 |
| **孕期营养指导** | 分孕期的营养需求、饮食禁忌、食谱推荐 | 科学饮食，避免误区 |
| **孕检报告解读** | AI 辅助解读各项指标含义 | 减少"指标异常"带来的恐慌 |

#### 1.2.3 孕检记录的延伸价值

孕检记录不仅是健康管理工具，还有 **实际的行政用途**：

| 场景 | 功能 | 价值 |
|------|------|------|
| **生育保险报销** | 一键打包下载所有孕检记录 | 材料齐全，报销流程顺畅 |
| **政府津贴申请** | 跳转随申办等政务平台 | 减少跨平台操作，提升体验 |

#### 1.2.4 月子期

| 功能 | 描述 | 价值 |
|------|------|------|
| **月子食谱** | 按产后恢复阶段的营养食谱推荐 | 科学调理，促进恢复 |
| **产后恢复指导** | 伤口护理、母乳喂养、产后运动等 | 专业指导，减少护理焦虑 |

#### 1.2.5 育儿期

| 功能 | 描述 | 价值 |
|------|------|------|
| **AI 月嫂/育儿嫂** | 小月龄常见问题即时咨询（黄疸、肠绞痛、睡眠等） | 7×24 小时可用，缓解新手父母焦虑 |
| **辅食添加指南** | 6 月龄起的辅食添加时机、食材、过敏观察 | 科学喂养，避免常见误区 |
| **生长发育追踪** | 身高体重曲线、发育里程碑对照 | 早期发现发育偏离 |
| **疫苗接种提醒** | 接种时间表、注意事项、异常反应处理 | 不遗漏，少焦虑 |

### 1.3 产品价值

#### 对用户
- **信息降噪**：从海量母婴信息中筛选可靠内容
- **决策支持**：AI 辅助判断"是否正常"、"是否需要就医"
- **持续陪伴**：从备孕到育儿，全周期的 AI 健康伴侣
- **效率提升**：孕检记录管理、政务跳转等实用功能

#### 对蚂蚁阿福
- **高频场景**：母婴期是健康咨询的高频时段，用户粘性强
- **用户增长**：触达年轻家庭用户群体
- **生态协同**：与医保、政务、本地生活等蚂蚁生态能力联动

### 1.4 与 GUI Agent 的结合

在母婴场景中，GUI Agent 可以作为 **自动化执行层**，辅助完成跨平台操作：

| 场景 | GUI Agent 价值 |
|------|---------------|
| **政务办理** | 自动跳转随申办，辅助填写津贴申请表单 |
| **预约挂号** | 自动完成医院 App 的科室选择、医生预约 |
| **报告下载** | 自动从医院 App 下载孕检报告并整理归档 |

这体现了 **AI 健康伴侣 + GUI Agent** 的协同价值：阿福提供健康决策支持，GUI Agent 负责执行落地。

---

## 2. GUI Agent 挂号场景 Demo

### 2.1 项目简介

基于视觉的 GUI 自动化框架，使用 ReAct Agent 模式控制电脑屏幕，实现医院挂号等复杂操作的自动化。

**核心特性**：
- **纯视觉方案**：跨平台通用，支持任何 GUI 界面
- **ReAct Agent**：自主决策，多轮迭代完成复杂任务
- **Token 优化**：截图历史裁剪，只保留最近 5 张截图
- **归一化坐标**：0-1000 坐标系统，适配不同分辨率

### 2.2 技术方案选型

#### 2.2.1 方案对比

| 方案 | 描述 | 优点 | 缺点 |
|------|------|------|------|
| **DOM 方案** | 解析页面 DOM 树，提取元素信息供模型决策 | Token 消耗低，定位精准 | 兼容性差，适用场景有限 |
| **纯视觉方案** | 仅依赖屏幕截图，模型理解图像内容并输出坐标 | 通用性强，无需适配 | Token 消耗高，依赖模型视觉能力 |
| **混合方案** | Agent 自主选择 DOM 或视觉方式 | 理论最优 | 实现复杂，且 DOM 工具适用场景有限 |

#### 2.2.2 DOM 方案的优势

| 场景 | DOM 方案 | 纯视觉方案 |
|------|---------|-----------|
| **信息获取** | 一次获取页面所有可操作元素 | 需多次滚动截图才能看全 |
| **滚动操作** | 可直接跳转到目标元素 | 需反复滚动、截图、判断 |
| **决策速度** | 结构化数据，模型快速理解 | 图片解析，Token 消耗高 |

**挂号场景案例**：

| 方案 | 操作流程 | 耗时 |
|------|---------|------|
| **DOM 方案** | 一次性获取所有科室列表 → 模型直接选择目标科室 → 点击挂号 | 1-2 轮 |
| **纯视觉方案** | 截图 → 看不到目标科室 → 滚动 → 截图 → 继续滚动... → 找到 → 点击 | 5-10 轮 |

#### 2.2.3 DOM 方案的局限性

**技术层面**：

| 问题 | 具体表现 |
|------|---------|
| **Canvas 无法解析** | 游戏、图表、白板等 Canvas 应用无 DOM 结构 |
| **代码混淆** | 现代前端框架（React/Vue）打包后 class/id 无语义 |
| **Shadow DOM** | Web Components 内部 DOM 无法直接访问 |
| **iframe 跨域** | 跨域 iframe 内部 DOM 无法获取 |

**平台层面**：

| 平台 | DOM 支持情况 |
|------|-------------|
| **移动端原生 App** | 完全无 DOM，需依赖 Accessibility API |
| **微信小程序** | 自定义组件结构，与 Web DOM 不兼容 |
| **桌面应用** | Electron 有 DOM，原生应用无 DOM |
| **跨平台框架** | Flutter/React Native 无标准 DOM |

**获取成本**：

| 问题 | 说明 |
|------|------|
| **需要浏览器插件/控制** | 必须通过 Chrome Extension 或 Playwright 等工具获取 DOM |
| **无法适配任意应用** | 只能针对特定平台开发，通用性差 |
| **Demo 验证困难** | 快速验证想法时，DOM 方案的前置工作量大 |

#### 2.2.4 选型结论

**生产环境推荐：混合方案**

| 条件 | 推荐方案 |
|------|---------|
| **能获取 DOM** | 优先使用 DOM，效率高、Token 消耗低 |
| **无法获取 DOM** | 降级到纯视觉方案 |

**当前 Demo 选择：纯视觉方案**

- ✅ **Demo 验证优先**：快速验证 GUI Agent 的可行性
- ✅ **通用性强**：跨平台通用，无需适配不同技术栈
- ✅ **实现简单**：无需浏览器插件或额外依赖

### 2.3 模型选型

#### 2.3.1 候选模型评估

| 模型 | Tool Call 能力 | 视觉理解 | 坐标定位 | 逻辑推理 | 结论 |
|------|---------------|---------|---------|---------|------|
| **豆包 1.5 UI-TARS** | ❌ 极差 | ✅ 正常 | ✅ 正常 | ❌ 较差 | 不可用 |
| **豆包 1.6 Pro Vision** | ✅ 正常 | ✅ 正常 | ✅ 正常 | ❌ 较差 | 不推荐 |
| **Gemini 3 Flash** | ✅ 优秀 | ✅ 优秀 | ✅ 优秀 | ✅ 优秀 | **最终选择** |

#### 2.3.2 问题详情

**豆包 1.5 UI-TARS**：
- Tool Call 输出极不稳定，JSON 直接输出到 content 而非 tool_calls 字段
- 逻辑推理能力差，容易陷入重复错误操作的死循环

**豆包 1.6 Pro Vision**：
- Tool Call、视觉理解、坐标定位能力均正常
- **唯一短板是逻辑推理**：遇到障碍时不会变通，反复重试同一失败操作

#### 2.3.3 最终选择：Gemini 3 Flash

| 能力 | 表现 |
|------|------|
| **Tool Call** | 100% 正确输出结构化调用 |
| **视觉理解** | 准确识别 UI 元素、文字、图标 |
| **坐标定位** | 坐标误差小，点击准确 |
| **逻辑推理** | 能分析操作失败原因并调整策略 |
| **指令遵循** | 严格按照 System Prompt 执行 |

### 2.4 Agent 框架选型

#### 2.4.1 候选框架评估

| 框架 | 特点 | 问题 | 结论 |
|------|------|------|------|
| **Google ADK** | 针对 Gemini 优化 | 不支持 OpenAI 格式的图片作为 Tool Call 返回 | 放弃 |
| **AgentScope** | 阿里出品，功能完善 | Gemini 模型供应商兼容性未做好 | 放弃 |
| **自己实现 ReAct** | 完全可控，实现简单 | 需自行实现 | **最终选择** |

#### 2.4.2 最终选择：自己实现 ReAct Agent

由于主流框架都存在图片返回兼容性问题，选择自己实现 ReAct Agent，**绕过 Tool Call 返回图片的限制**：

- 传统方式：Tool 结果（含图片）作为 `tool` message → 供应商不支持
- 我们的方式：Tool 结果仅返回文本，图片作为 `user` message 追加 → 全兼容

**优点**：
- ✅ 兼容所有 OpenAI 格式 API
- ✅ 无需依赖供应商的图片返回支持
- ✅ ReAct 循环逻辑简单，易于调试
- ✅ 完全可控，可灵活扩展

### 2.5 Token 优化策略

#### 2.5.1 问题背景

纯视觉方案的最大问题是 **Token 消耗爆炸**：
- 每张截图 ≈ 1000-2000 tokens
- 10 轮迭代 ≈ 10 张截图
- 单次任务 ≈ 10,000-20,000 tokens（仅图片）

#### 2.5.2 解决方案：截图历史裁剪

**策略**：只保留最近 N 张截图，更早的截图从上下文中移除，但保留文本描述。

| 场景 | 无裁剪 | 保留 5 张 | 节省 |
|------|-------|----------|------|
| 5 轮迭代 | 5 张 | 5 张 | 0% |
| 10 轮迭代 | 10 张 | 5 张 | 50% |
| 20 轮迭代 | 20 张 | 5 张 | 75% |

**经验值**：5 张截图是较好的平衡点。

### 2.6 工具集设计

#### 2.6.1 工具列表

| 工具 | 参数 | 功能 |
|------|------|------|
| `screenshot` | 无 | 截取当前屏幕 |
| `click` | `x, y, click_type` | 点击（left/right/double） |
| `type_text` | `text, x?, y?, press_enter?` | 输入文本，可选点击获取焦点和按回车 |
| `scroll` | `x, y, direction, amount` | 滚动屏幕 |

#### 2.6.2 坐标系统

使用 **0-1000 归一化坐标**：
- 模型输出稳定（整数范围 0-1000）
- 屏幕分辨率无关
- 避免 Retina 缩放问题

#### 2.6.3 截图时机

| 工具 | 截图延迟 | 原因 |
|------|---------|------|
| screenshot | 0ms | 立即获取当前状态 |
| click | 500ms | 等待界面响应 |
| type_text | 500ms | 等待文字渲染 |
| scroll | 500ms | 等待滚动动画 |

### 2.7 技术总结

#### 2.7.1 技术栈

| 层次 | 选型 | 原因 |
|------|------|------|
| **架构方案** | 纯视觉方案 | 跨平台通用，无需适配 |
| **视觉模型** | Gemini 3 Flash | Tool Call 稳定，视觉理解强 |
| **Agent 框架** | 自己实现 ReAct | 绕过图片返回兼容性问题 |
| **GUI 操作** | PyAutoGUI | 跨平台，API 简洁 |

#### 2.7.2 关键设计

1. **图片作为 User Message**：绕过 Tool Call 图片返回的兼容性问题
2. **截图历史裁剪**：控制 Token 消耗，保留最近 5 张截图
3. **归一化坐标**：0-1000 范围，屏幕分辨率无关
4. **精简工具集**：4 个核心工具，覆盖 90% 使用场景

#### 2.7.3 未来优化方向

| 方向 | 描述 |
|------|------|
| **智能截图时机** | 检测页面变化后再截图，替代固定延迟 |
| **DOM 混合方案** | 生产环境中优先使用 DOM，降级到视觉 |
| **Multi-Agent 架构** | MainAgent 调度 + GUI Agent 执行 |
